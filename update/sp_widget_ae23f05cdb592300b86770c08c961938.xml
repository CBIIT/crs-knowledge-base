<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope,$rootScope, $mdDialog, $sce, $location, NERDArticle, NERDComment, NERDTag, NERDFile) {
  /* widget controller */
  var c = this;
	var s = $location.search();
	//callback for deletion
	var cb = null;
	
	c.save_warning_text = "Post";
	c.versionsHidden  = true;
	c.versions = [];
	c.links = [];
	c.ref_number = [];
	c.kc = [];
	
	c.tags = [];
	c.your_tags = [];
	c.attachments = [];
	
	
	var template = {"u_kb_template_top_accomplishment":
									['Cancer Site/Type',
									 'Research Type',
									 'Special Topic',
									 'Description',
									 'References',
									 'Involved organization', 
									 'DOC', 
									 'Fiscal Year'],
									"u_kb_template_gpra": 
									[
									 'Measure ID',
									 'Research Type',
									 'Special Topic',
									 'DOC',
									 'Contacts',
									 'Description',
									 'Summary',
									 'Background',
									 'Target Context and Conditions', 
									 'Fiscal Year'],
									"u_kb_template_literature_summary": 
									[
									 'Cancer Site/Type',
									 'Research Type',
									 'Special Topic',
									 'Description',
									 'References',
									 'Funding', 
									 'Journal',
									 'Fiscal Year'],
									"u_kb_template_miscellaneous": 
									[
									 'Cancer Site/Type',
									 'Research Type',
									 'Description', 
									 'Special Topic',
									 'Fiscal Year'],
									"u_kb_template_final_reports": 
									[
									 'Cancer Site/Type',
									 'Research Type',
									 'Description', 
									 'Special Topic',
									 'Fiscal Year'],
									"u_kb_template_significant_items": 
									[
									 'Cancer Site/Type',
									 'Research Type',
									 'Special Topic',
									 'Congressional Language',
									 'Action taken or to be taken',
									 'References',
									 'CRS Author',
									 'Fiscal Year'],
									"u_kb_template_miscellaneous_me": 
									[
									 'Moonshot Recommendation',
									 'Cross-cutting themes and goals',
									 'CMIT',
									 'Description',
									 'Point of contact and contact information',
									 'Fiscal Year'],
									"u_kb_template_presentations": 
									[
									 'CRS POC(s)',
										'Project',
									 'Date Presented or Shared',
									 'Presented to',
									 'Originated outside of CRS',
									 'Obtained permission to share within CRS',
									 'Originator/Owner',
									 'Presented to leadership level',
									 'Presented to public',
										'Brief Description',
										'Placeholder: Suggested tags/keywords',
										'Where related information can be found',
										'Comments',
										'Includes analysis',
										'Are the data in draft form',
										'Is the underlying data covered under a DUDA',
										'Analysis Notes']
				   };
	//c.knowledge_id = s.kb_knowledge_base;
	//c.cat = s.cat;
	c.hasFilter = s.hasFilter;
	c.upload_status = "upload";
	c.errorMessage = false;
	c.file2upload = '';
	c.isSu = $rootScope.user.role.indexOf('su') > -1;
	c.currentUserID = $rootScope.user.id;
	c.currentUserName = $rootScope.user.name;
	var sessionId = c.data.info.sessionId;
	var data = {};
	var columns = [];
	var title = "";
	var params = {};
	params.doc_id = s.aid;
	params.template_id = s.tid;
	c.template_id = s.tid;
	params.version = s.version? s.version : "";
	
	c.getLinks = function(){
		var lk = {};
		lk.number = $scope.number;
		lk.knowledge_base = c.knowledge_id;
		
		NERDArticle.getLinks(lk, sessionId).then(function(res){
				var result = res.data.result;
			  c.links = result;
			  c.ref_number = [];
			  c.links.forEach(function(link){
					c.ref_number.push(link.number);
				});
			  $scope.$apply();
			},function(error){
				console.log(error);
			});
	};
	
	c.getVersions = function(start, number, cb){
		var pr = {};
		pr.version = start;
		pr.number = number;
		
		NERDArticle.getVersions(pr, sessionId).then(function(res){
				var result = res.data.result;
			  if(result.length == 5){
					c.hasMore = true;
			  }
			  else{
					c.hasMore = false;
				}
			  result.forEach(function(element){
					if(element.version.indexOf(".") == -1){
						element.version += ".0";
					}
					c.versions.push(element);
				});
				if(cb){
					cb();
				}
			  $scope.$apply();
			},function(error){
				console.log(error);
			});																 
	};
	
	NERDArticle.getArticle(params, sessionId).then(function(res){
		$scope.data = res.data.result;
		c.knowledge_id = $scope.data.kb;
		c.cat = $scope.data.cat;
		c.author = $scope.data.author;
		c.author_id = $scope.data.author_id;
		
		if(c.knowledge_id == 'f5644dcadb54ab0054d8ff621f9619d7'){
			c.kc.push({id:'u_kb_template_top_accomplishment',label:'Top Accomplishments'});
			c.kc.push({id:'u_kb_template_gpra',label:'GPRA'});
			c.kc.push({id:'u_kb_template_significant_items',label:'Significant Items'});
			c.kc.push({id:'u_kb_template_final_reports',label:'Final Reports'});
			c.kc.push({id:'u_kb_template_literature_summary',label:'Literature Summary'});
			c.kc.push({id:'u_kb_template_miscellaneous',label:'Miscellaneous'});
		}
		else if(c.knowledge_id == 'ff315a9edba47340b86770c08c961999'){
			c.kc.push({id:'u_kb_template_presentations',label:'Presentations'});
		}
		else if(c.knowledge_id == '2c42d2dedba47340b86770c08c9619a9'){
			c.kc.push({id:'u_kb_template_miscellaneous_me',label:'Miscellaneous'});
		}
		c.selectedKnowledgeCategory = c.kc[0];
		
		$scope.number = $scope.data.number;
		$scope.title = $scope.data.Title;
		$scope.version = $scope.data.version;
		if($scope.version.indexOf(".") == -1){
			$scope.version += ".0";
		}
		$scope.annotation = $scope.data.annotation;
		$scope.latest = $scope.data.latest;
		$scope.editable = $scope.data.editable;
		$scope.warning = $scope.data.warning;
		c.warning = $scope.warning;
		$scope.columns = template[params.template_id];
		
		if(c.cat == 'Literature Summary'){
			var pmids = $scope.data.References;
			if(pmids != "N/A"){
				var links = [];
				pmids.split(",").forEach(function(pd){
					links.push("<p><a href='https://www.ncbi.nlm.nih.gov/pubmed/"+pd+"' target='_blank'>"+pd+"</a></p>");
				});
				$scope.data.References = "<p>PMIDs:</p>"+ links.join("");
			}
			
			var funding = $scope.data.Funding;
			if(funding != "N/A"){
				var arr = funding.split('|');
				if(arr[0] == 'Yes'){
					$scope.data.Funding = "<p>This study has no NCI funding.</p>";
				}
				else{
					$scope.data.Funding = "";
				}
				if(arr[1].trim() != ''){
					$scope.data.Funding += "<p>Funding information: "+arr[1].trim()+"</p>";
				}
			}
		}
		if(c.cat == 'Presentations'){
			var idx = 0;
			if($scope.data['Originated outside of CRS'] == 'Yes'){
				idx = $scope.columns.indexOf('Presented to leadership level');
				$scope.columns.splice(idx, 2);
				idx = $scope.columns.indexOf('Where related information can be found');
				$scope.columns.splice(idx, 6);
			}
			else{
				idx = $scope.columns.indexOf('Obtained permission to share within CRS');
				$scope.columns.splice(idx, 2);
				if($scope.data['Includes analysis'] == 'No'){
					idx = $scope.columns.indexOf('Are the data in draft form');
					$scope.columns.splice(idx, 3);
				}
			}
		}
		c.tags = c.parseTags($scope.data.tags);
		
		c.your_tags = [];
		$scope.data.your_tags.forEach(function(elem){
			c.your_tags.push(elem.substring(1, elem.length - 1));
		});
		//$scope.tags 
		
		$scope.comments = $scope.data.comments;
		c.attachments = $scope.data.attachments;
		$scope.$apply();
		c.getVersions("", $scope.number);
		c.getLinks();
	}, function(error){
		console.log(error);
	});
	
	c.swithKnowledgeCategory = function(){
		c.querySearch();
	};
	
	c.addtoReference = function(item, ev){
		ev.stopPropagation();
		var link = {};
		link.number = $scope.number;
		link.reference = item.number;
		link.template = item.template;
		NERDArticle.addLink(link, sessionId).then(function(res){
				var result = res.data.result;
			  c.getLinks();
			  $scope.$apply();
			},function(error){
				console.log(error);
			});
	};
	
	c.openArticle = function(article){
		s.xpage = "kd_article_view";
		s.kb_knowledge_base = article.kb_knowledge_base;
		s.aid = article.aid;
		s.number = article.number;
		s.tid = article.tid;
		$location.search(s).replace();
	};
	
	c.deleteLink = function(article){
		var lk = {};
		lk.number = $scope.number;
		lk.reference = article.number;
		lk.template = article.tid;
		NERDArticle.deleteLink(lk, sessionId).then(function(res){
				c.getLinks();
				$scope.$apply();
			}, function(error){
				console.log(error);
			});
	}
	
	c.gotoEdit = function(v){
		s.xpage = "kd_article_edit";
		s.version = v;
		$location.search(s).replace();
	};
	
	c.saveWarning = function(ev){
		
		var ps = {};
		ps.template = params.template_id;
		ps.number = $scope.number;
		ps.warning = c.warning;
		
		NERDArticle.saveWarning(ps, sessionId).then(function(res){
				var result = res.data.result;
			  $scope.warning = result;
			  c.warning = result;
			  $scope.$apply();
				window.showMessageBox("Warning/Caution has been successfully posted.");
			},function(error){
				console.log(error);
			});							
	};
	
	c.deleteWarning = function(){
		var ps = {};
		ps.template = params.template_id;
		ps.number = $scope.number;
		ps.warning = "";
		
		NERDArticle.saveWarning(ps, sessionId).then(function(res){
				var result = res.data.result;
			  $scope.warning = result;
				c.warning = result;
			  $scope.$apply();
				window.showMessageBox("Warning/Caution has been cleared.");
			},function(error){
				console.log(error);
			});
	}
	
	c.switchVersions = function(){
		c.versionsHidden = !c.versionsHidden;
		var growDiv = document.getElementById('grow');
		if (growDiv.clientHeight) {
			growDiv.style.height = 0;
		} else {
			var len = c.versions.length;
			if(c.hasMore){
				len += 1;
			}
			growDiv.style.height = len * 25 + "px";
		}
	}
	
	c.switchtoVersion = function(version){
		s.version = version;
		$location.search(s).replace();
	};
	
	c.loadMoreVersions = function(number){
		c.getVersions(c.versions[c.versions.length -1].version, number, function(){
			var growDiv = document.getElementById('grow');
			var len = c.versions.length;
			if(c.hasMore){
				len += 1;
			}
			growDiv.style.height = len * 25 + "px";
		});
	}
	
	/*
	var fileInput  = document.getElementById("file2upload");

	fileInput.addEventListener( "change", function( event ) {
		c.file2upload = this.value;
		$scope.$apply();
	});
	
	function readFile(file, callback) {
		var fileReader = new FileReader();
		fileReader.onload = function() {
			var result = fileReader.result.replace('data:application/pdf;base64,', '');
			callback(result);
		}
		fileReader.readAsDataURL(file); //file must be base64
	}
	
	c.upload = function(){
		c.upload_status = 'uploading...';
		
		var input = $('#file2upload')[0];
		var file = input.files[0];
		
		if(file.type !== 'application/pdf' && file.type !== 'application/vnd.ms-powerpoint' && file.type !== 'application/vnd.openxmlformats-officedocument.presentationml.presentation'){
			console.log("please upload a pdf or powerpoint file.");
			c.errorMessage = true;
			c.upload_status = 'upload';
		}
		else if(file.size > 18874368){
			console.log("File size should not exceed 18 MB.");
			c.errorMessage = true;
			c.upload_status = 'upload';
		}
		else{
		  readFile(file, function(base64) {
				var filename = file.name;
				var attach = {
								sys_id: params.doc_id,
								tmp_id: params.template_id,
								fileName: filename,
								fileType: file.type,
								fileContents : base64
							};
				NERDFile.uploadPDF(attach, sessionId).then(function(res){
					if(res){
						c.upload_status = 'upload';
						c.errorMesage = false;
						$scope.attachments = res.data.result;
						$scope.$apply();
					}
				}, function(error){
						console.log(error);
				});
			});	
		}
	};
	
	c.removeAttachment = function(attach_sys_id){
		
		cb = function(callback){
				//post to server
				var attach = {
					sys_id: params.doc_id,
					tmp_id: params.template_id
				};
				attach.attachment_sys_id = attach_sys_id;
				NERDFile.removePDF(attach, sessionId).then(function(res){
					if(res){
						$scope.attachments = res.data.result;
						$scope.$apply();
					}
					callback();
				}, function(error){
					console.log(error);
				});
		};
		$('#deletionDiv').modal('show');
		
	};
	*/
	
	c.tagAdding = function(){
		if(c.tag2add && c.tag2add.trim() !== ""){
			//post to server
			NERDTag.addPersonalTag($scope.number, params.template_id,c.knowledge_id, c.tag2add, sessionId).then(function(res){
				var tags = res.data.result;
				c.your_tags = [];
				tags.forEach(function(elem){
					c.your_tags.push(elem.substring(1, elem.length - 1));
				});
				$scope.$apply();
			}, function(error){
				console.log(error);
			});
		}
		
	};
	
	c.tagRemoving = function(tag){
		//post to server
		NERDTag.removeTag(params.doc_id , params.template_id, tag, sessionId).then(function(res){
			var tags = res.data.result;
			c.tags = c.parseTags(tags);
			$scope.$apply();
		}, function(error){
			console.log(error);
		});
	};
	
	c.shareTag = function(tag){
		//post to server
		NERDTag.shareTag($scope.number, params.template_id, tag, sessionId).then(function(res){
			var tags = res.data.result;
			c.tags = c.parseTags(tags);
			$scope.$apply();
		}, function(error){
			console.log(error);
		});
	};
	
	c.removePersonalTag = function(tag){
		//post to server
		NERDTag.removePersonalTag($scope.number, params.template_id,c.knowledge_id, tag, sessionId).then(function(res){
			var tags = res.data.result;
			c.your_tags = [];
			tags.forEach(function(elem){
				c.your_tags.push(elem.substring(1, elem.length - 1));
			});
			$scope.$apply();
		}, function(error){
			console.log(error);
		});
	}
	
	c.loadDictionary = function(query){
		var tags = [{text: '21st Century Cures Act'},
								{text: 'Abortion'},
								{text: 'Adolescent and Young Adult (AYA)'},
								{text: 'Advocacy'},
								{text: 'Aging'},
								{text: 'Angiogenesis'},
								{text: 'Animal Models'},
								{text: 'Appropriations'},
								{text: 'Asbestos'},
								{text: 'Behavioral Research'},
								{text: 'Big Data'},
								{text: 'Biospecimens'},
								{text: 'Blue Ribbon Panel'},
								{text: 'BRAIN'},
								{text: 'Breast Cancer Stamp'},
								{text: 'Breast Density'},
								{text: 'Bypass Budget'},
								{text: 'Cancer Centers'},
								{text: 'Cancer Clusters'},
								{text: 'Carbon Ion Therapy'},
								{text: 'Childhood Cancer Caucus'},
								{text: 'Clinical Center'},
								{text: 'Clinical Trials'},
								{text: 'CMS'},
								{text: 'Comparative Effectiveness Research'},
								{text: 'Complementary and Alternative Medicine'},
								{text: 'Conflict of Interest'},
								{text: 'Congressional Report'},
								{text: 'Contracts'},
								{text: 'Cost of Care'},
								{text: 'Deadly Cancers'},
								{text: 'Diagnostics'},
								{text: 'Distress Screening'},
								{text: 'Down Syndrome'},
								{text: 'Drug Development'},
								{text: 'Drug Shortages'},
								{text: 'Early Stage Investigators '},
								{text: 'Environmental Carcinogens'},
								{text: 'Ethics'},
								{text: 'Exceptional Responders '},
								{text: 'FDA'},
								{text: 'FFRDC'},
								{text: 'Funding'},
								{text: 'Genomics'},
								{text: 'Genomic Data Commons'},
								{text: 'Global Health'},
								{text: 'Glyphosphate'},
								{text: 'Grants'},
								{text: 'Health Economics'},
								{text: 'Health Services Research'},
								{text: 'HIV/AIDS'},
								{text: 'HPV '},
								{text: 'Imaging'},
								{text: 'Immuno-oncology'},
								{text: 'Immunotherapy'},
								{text: 'Indirect Costs'},
								{text: 'Information Management'},
								{text: 'Information Technology'},
								{text: 'International Agency for Research on Cancer (IARC)'},
								{text: 'Legislative Proposals'},
								{text: 'Lymphedema'},
								{text: 'Mammography'},
								{text: 'Medical Radiation'},
								{text: 'Mesothelioma'},
								{text: 'Microbiome'},
								{text: 'Mitochondrial Disease'},
								{text: 'Mobile Health (mHealth)'},
								{text: 'Nanotechnology'},
								{text: 'Natural Products'},
								{text: 'NCORP'},
								{text: 'NCTN'},
								{text: 'Neurofibromatosis'},
								{text: 'NIH Strategic Plan'},
								{text: 'Obesity'},
								{text: 'Open Access'},
								{text: 'Other Transactions Authority (OTA)'},
								{text: 'Oversight'},
								{text: 'Palliative Care'},
								{text: 'Partnership to Advance Cancer Health Equity'},
								{text: 'PDAC'},
								{text: 'Pediatric Drugs/Devices'},
								{text: 'Pediatric Research Initiative'},
								{text: 'Precision Medicine Initiative'},
								{text: 'Precision/Personalized Medicine'},
								{text: 'Priority Setting'},
								{text: 'Quality of Care'},
								{text: 'Radiation'},
								{text: 'RECA'},
								{text: 'RECA Case Review'},
								{text: 'Recalcitrant Cancer Research Act (RCRA)'},
								{text: 'Regenerative Medicine'},
								{text: 'Registries'},
								{text: 'Report Langauge'},
								{text: 'Reproducibility'},
								{text: 'Reproductive Health'},
								{text: 'Return on Investment'},
								{text: 'SBIR/STTR'},
								{text: 'Screening'},
								{text: 'SEER'},
								{text: 'SPOREs'},
								{text: 'State Funding'},
								{text: 'Statistics/Trends'},
								{text: 'Stem Cells'},
								{text: 'Synthetic Biology'},
								{text: 'Targeted Therapies'},
								{text: 'TCGA'},
								{text: 'Tech Transfer'},
								{text: 'Tobacco'},
								{text: 'Transition Planning'},
								{text: 'Triple Negative Breast Cancer'},
								{text: 'USPSTF'},
								{text: 'Women’s Health '},
								{text: 'SCLC'}
							 ];

		var result = tags.filter(function(t){
			return t.text.toLowerCase().startsWith(query.toLowerCase());
		});
		
		return result;
	};
	
	c.querySearch = function(searchText){
		var atc = {};
		atc.number = $scope.number;
		atc.search_text = searchText;
		atc.template = c.selectedKnowledgeCategory.id;
		
		return NERDArticle.searchArticleByText(atc, sessionId).then(function(res){
				var result = res.data.result;
				result.forEach(function(item){
					item.value = item.number;
					item.display = item.title;
				});
				return result;
			}, function(error){
				console.log(error);
			});
		
	};
	
	c.addComment = function(){
		//post to server
		NERDComment.addComment(params.doc_id, c.comment, sessionId).then(function(res){
			var comments = res.data.result;
			$scope.comments = comments;
			c.comment = '';
			$scope.$apply();
		}, function(error){
			console.log(error);
		});
	};
	
	c.deleteComment = function(sys_id){
		//post to server
		cb = function(callback){
				NERDComment.deleteComment(sys_id, sessionId).then(function(res){
				var comments = res.data.result;
				$scope.comments = comments;
				c.comment = '';
				$scope.$apply();
				callback();
			}, function(error){
				console.log(error);
			});
		};
		$('#deletionDiv').modal('show');
	};
	
	c.gotoDeletion = function(){
		if(cb){
			cb(function(){
				$('#deletionDiv').modal('hide');
			});
		}
	};
	
	c.cancelDeletion = function(){
		$('#deletionDiv').modal('hide');
	};
	
	c.parseTags = function(tags){
		//console.log(tags);
		var result = [];
		if(tags !== ''){
			tags.split(",").forEach(function(elem){
				result.push(elem.substring(1, elem.length - 1));
			});
		}
		return result;
	};
	
	c.trustAsHtml = function(string) {
    return $sce.trustAsHtml(string);
  };
	
	if(c.hasFilter == '1'){
	  if(s.f1 && s.f1 !== ""){
			$rootScope.searchString = s.f1.split('|');
		}
		if(s.f2 && s.f2 !== ""){
			$rootScope.selectedYear = s.f2.split('|');
		}
		if(s.f3 && s.f3 !== ""){
			$rootScope.selectedDoc = s.f3.split('|');
		}
		if(s.f4 && s.f4 !== ""){
			$rootScope.selectedCancerSite = s.f4.split('|');
		}
		if(s.f5 && s.f5 !== ""){
			$rootScope.selectedResearchType = s.f5.split('|');
		}
		if(s.f6 && s.f6 !== ""){
			$rootScope.selectedSpecialTopic = s.f6.split('|');
		}
		if(s.f7 && s.f7 !== ""){
			$rootScope.selectedRecommendation = s.f7.split('|');
		}
		if(s.f8 && s.f8 !== ""){
			$rootScope.selectedThemesGoals = s.f8.split('|');
		}
		if(s.f9 && s.f9 !== ""){
			$rootScope.selectedCmit = s.f9.split('|');
		}
		if(s.f10 && s.f10 !== ""){
			$rootScope.selectedProject = s.f10.split('|');
		}
		if(s.f11 && s.f11 !== ""){
			$rootScope.selectedTags = s.f11.split('|');
		}
		if(s.f12 && s.f12 !== ""){
			$rootScope.selectedMyTags = s.f12.split('|');
		}
	}
	
}]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>crs-kd-article</id>
        <internal>false</internal>
        <link/>
        <name>[crs] KD Article</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  var session_id = gs.getSession().getSessionToken();
	data.info = {
		sessionId: session_id
	};

})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>yuw5@nih.gov</sys_created_by>
        <sys_created_on>2018-10-17 20:16:40</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>ae23f05cdb592300b86770c08c961938</sys_id>
        <sys_mod_count>770</sys_mod_count>
        <sys_name>[crs] KD Article</sys_name>
        <sys_package display_value="CRS Knowledge Database" source="x_26385_crs_kd">404e613b4f9213007221e321a310c738</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="CRS Knowledge Database">404e613b4f9213007221e321a310c738</sys_scope>
        <sys_update_name>sp_widget_ae23f05cdb592300b86770c08c961938</sys_update_name>
        <sys_updated_by>yuw5@nih.gov</sys_updated_by>
        <sys_updated_on>2019-05-30 21:23:11</sys_updated_on>
        <template><![CDATA[<div id="crs-article">
  <div class="container">
    <div class="row row-space">
      <div class="history-block">
      	<a ng-href="nerd?xpage=kd_search&kb_knowledge_base={{c.knowledge_id}}&hasFilter={{c.hasFilter}}"><i class="fa fa-arrow-left" aria-hidden="true"></i> Back to search</a>
  		</div>
    </div>
    <div class="row row-space">
          <div class="col-md-9 article-block">
						<div class="block-header">
                <h4  class="modal-title">{{title}}</h4>
            </div>
            <div class="block-info">
              <div ng-show="c.versionsHidden" style="width:70%;">
                <a href="#" ng-click="c.switchVersions()"><i class="fa fa-caret-right" style="width:10px;"></i> Version {{version}} - {{annotation}}</a>
              </div>
              <div ng-show="!c.versionsHidden" style="width:70%;">
                <a href="#" ng-click="c.switchVersions()"><i class="fa fa-caret-down" style="width:10px;"></i> Version {{version}} - {{annotation}}</a>
              </div>
              <div style="width:30%;text-align:right;" ng-if="c.isSu || c.author_id == c.currentUserID">
                  <a href="#" ng-click="c.gotoEdit(version)" ng-if="(c.template_id == 'u_kb_template_top_accomplishment'|| c.template_id == 'u_kb_template_literature_summary' || c.template_id == 'u_kb_template_miscellaneous_me' || c.template_id == 'u_kb_template_presentations') && editable">+ Edit this Article</a>
              </div>
            </div>
            <div id='grow' style="border-bottom: 1px solid lightgray;">
              <div class="block-versions" ng-class="version == article.version? 'active' : ''" ng-repeat="article in c.versions">
                <a href="#" ng-click="c.switchtoVersion(article.version)" ng-if="version != article.version">v{{article.version}} - {{article.annotation}}</a>
                <span ng-if="version == article.version">v{{article.version}} - {{article.annotation}}</span>
              </div>
              <div class="block-versions" style="text-align:center;">
                <a href="#" ng-click="c.loadMoreVersions(number)" ng-if="c.hasMore">Load More</a>
              </div>
            </div>
            
            <div class="block-body">
              <div style="text-align:center;" ng-show="warning && warning != ''">
                <div style="padding: 5px 10px;border: 1px solid lightgray;border-radius: 5px;background: lightyellow;font-size: 16px;font-weight: bold;"><i class="fa fa-exclamation-circle"></i> Caution/Warning: {{warning}}</div>
              </div> 
              <div>
                <h4 style="font-weight:bold;">Category</h4> 
                <div style="font-size:14px;">{{c.cat}}</div> 
              </div> 
              <div ng-repeat="item in columns track by $index">
                <h4 style="font-weight:bold;">{{item}}</h4> 
                <div ng-bind-html="c.trustAsHtml(data[item])" style="font-size:14px;"></div> 
              </div>
              <div>
                <h4 style="font-weight:bold;">Author</h4> 
                <div style="font-size:14px;">{{c.author}}</div> 
              </div>
            </div>
            <div class="block-footer">
              <div class="tag-label">
                Tags:
              </div>
              <div class="tag-area">
                <!--
                <tags-input ng-model="tags" replace-spaces-with-dashes=false on-tag-adding="c.tagAdding($tag)" on-tag-removing="c.tagRemoving($tag)">
                	<auto-complete source="c.loadDictionary($query)"
                     min-length="0"
                     load-on-focus="false"
                     load-on-empty="false"
                     select-first-match="false"
                     max-results-to-show="10"></auto-complete>
                </tags-input>
                -->
                <md-chips ng-model="c.tags" readonly="true" md-removable="true" md-on-remove="c.tagRemoving($chip)">
    						</md-chips>
              </div>
              <md-list>
                <div style="display:flex;background-color:rgb(250,250,250); height: 40px;">
                  <div class="col-md-8" style="line-height: 40px;">My Tags ({{c.your_tags.length}})</div>
                  <div  class="col-md-4" style="display:flex;">
                    <input type="text" class="form-control" style="margin-top: 3px;" placeholder="Tag to add" name="tag2add" id="tag2add" ng-model="c.tag2add">
                  	<md-button class="md-raised" style="background-color: #C6375D;color: white;min-width: 50px;height: 34px;margin: 3px 0px 0px 10px;min-height:34px; line-height:34px;" ng-show="c.tag2add && c.tag2add != ''" ng-click="c.tagAdding()">Add</md-button>
              			<md-button ng-disabled="true" class="md-raised md-primary" style="margin: 3px 0px 0px 10px;min-height:34px; line-height:34px;min-width: 50px;"  ng-show="c.tag2add == undefined || c.tag2add == ''">Add</md-button>
                  </div>
                </div>
                <md-list-item class="" ng-repeat="tag in c.your_tags">
                  <div class="md-list-item-text">
                    <h5>
                      {{tag}}
                    </h5>
                  </div>
                  <md-divider inset></md-divider>
                  <md-button class="md-secondary" ng-click="c.shareTag(tag)" ng-if="c.tags.indexOf(tag) == -1"  style="background-color: #C6375D;color: white;min-width: 50px;height: 34px;margin: 3px 0px 0px 10px;min-height:34px; line-height:34px;">Share</md-button>
                  <md-button class="md-secondary" ng-if="c.tags.indexOf(tag)  > -1" ng-disabled="true" style="background-color:lightgray;min-width: 50px;height: 34px;margin: 3px 0px 0px 10px;min-height:34px; line-height:34px;">Shared</md-button>
                  <md-button class="md-secondary" ng-click="c.removePersonalTag(tag)" style="background-color: #C6375D;color: white;min-width: 50px;height: 34px;margin: 3px 0px 0px 10px;min-height:34px; line-height:34px;">Delete</md-button>
                </md-list-item>
              </md-list>
            </div>
            <!--
            <div class="block-footer"  ng-show="!c.isSu && tags.length > 0">
              <div class="tag-label">
                Tags:
              </div>
              <div class="tag-area">
                <ul class="tag-list-readonly">
                  <li ng-repeat="tag in tags">{{tag.text}}</li>
                </ul>
              </div>
            </div>
            -->
          </div>
      
      		<div class="col-md-2 attch-block">
             <div class="section-header">
               Linked Records
            </div>
            <div class="section-content" ng-if="c.links.length == 0">
              <label style="width:100%; padding-left: 10px;margin-bottom: 0px;">
                No Linked Records 
              </label>
            </div>
            <div class="section-content" ng-if="c.links.length > 0">
              <a target="_blank" href="#" ng-click="c.openArticle(lk);" ng-repeat="lk in c.links">
                <i class="glyphicon glyphicon-file"></i> {{lk.title}}
              </a>
            </div>
          </div>

          <div class="col-md-2 attch-block" ng-if="c.attachments.length > 0">
             <div class="section-header">
               Attachments
            </div>
            <div class="section-content">
              <a target="_blank" href="sys_attachment.do?view=true&sys_id={{file.attach_sys_id}}" ng-repeat="file in c.attachments">
                <i ng-class="file.file_type == 'application/pdf' ? 'fa fa-file-pdf-o' : 'fa fa-file-powerpoint-o'" aria-hidden="true"></i> {{file.file_name}}</a>
            </div>
          </div>

		</div>
    <!-- attachment -->
    <!--
    <div class="row row-space">
      <div class="col-md-9 upload-block">
        <div class="upload-header">
          <h4>Upload Files</h4>
        </div>      
        <div class="upload-body">
          <div class="upload-form">
            <h4>File to upload</h4> 
            <div style="width:100%;"><input type="file" id="file2upload" class="form-control" style="cursor: pointer;"></div>
            
            <div style="width:100%; margin-top: 5px;overflow:auto;">
              <div class="col-md-6" style="padding-left:0px;">
                <h5 ng-if="!c.errorMessage">PDF/PPT only, Maximum upload size 18 MB</h5>
                <h5 ng-if="c.errorMessage" style="color: red;">PDF/PPT only, Maximum upload size 18 MB</h5>
              </div>
              <div class="col-md-6" style="text-align:right;padding-right:0px;">
                <button type="button" class="btn btn-primary" ng-click="c.upload()" ng-disabled="c.upload_status == 'uploading...' || c.file2upload == ''">{{c.upload_status}}</button></div> 
              </div>
          </div>
          <div class="file-list">
            <div class="file-block" ng-repeat="attach in attachments">
              <a target="_blank" href="sys_attachment.do?view=true&sys_id={{attach.attach_sys_id}}">
                <i ng-class="file.file_type == 'application/pdf' ? 'fa fa-file-pdf-o' : 'fa fa-file-powerpoint-o'" aria-hidden="true"></i> {{attach.file_name}}</a>
              <a class="btn-remove" ng-click="c.removeAttachment(attach.attach_sys_id)" role="link" ng-show="c.isSu || attach.created_by == c.currentUserName">×</a>
            </div>
          </div>
        </div>
      </div>
    </div>
		-->
    <!-- Linked Records section -->
    <div class="row row-space">
      <div class="col-md-9 upload-block">
        <div class="upload-header">
          <h4>Caution/Warning</h4>
        </div>      
        <div class="upload-body">
          <md-content flex style="margin-top:10px;">
            <div class="dialog_content">
              <textarea row=1 ng-model="c.warning" placeholder="Enter Caution/Warning here"  id="warning" name="warning" style="resize: vertical;" value="{{c.warning}}" class="form-control"></textarea>
            </div>
            <div class="dialog_footer" style="text-align:right;padding-bottom: 10px;padding-right: 10px; border-top: 0px;">
              <md-button class="md-raised" style="background-color: #C6375D;color: white;margin: 3px 0px 0px 10px;min-width: 50px;" ng-show="c.warning && c.warning != ''" ng-click="c.saveWarning($event)">{{c.save_warning_text}}</md-button>
              <md-button ng-disabled="true" class="md-raised md-primary" style="margin: 3px 0px 0px 10px;min-width: 50px;"  ng-show="c.warning == undefined || c.warning == ''">{{c.save_warning_text}}</md-button>
              <md-button class="md-raised" style="margin: 3px 0px 0px 10px;min-width: 50px;" ng-click="c.deleteWarning()">Clear</md-button>
            </div>
          </md-content>
        </div>
      </div>
    </div>
    <!-- Linked Records section -->
    <div class="row row-space">
      <div class="col-md-9 upload-block">
        <div class="upload-header">
          <h4>Linked Records</h4>
        </div>      
        <div class="upload-body">
          <md-content flex style="margin-top:10px;">
            <select class="form-control" name="kcSelect" id="kcSelect" ng-options="option.label for option in c.kc track by option.id"
                    ng-model="c.selectedKnowledgeCategory" style="display: inline;width: 25%;height: 40px;font-weight: inherit;">
            </select>
            <md-autocomplete style="border: 1px solid lightgray; border-radius: 5px;display: inline-block;width: 74%;"
                             ng-disabled="false"
                             md-no-cache="true"
                             md-search-text="c.searchText"
                             md-items="item in c.querySearch(c.searchText)"
                             md-item-text="item.display"
                             md-min-length="3"
                             md-dropdown-items="10"
                             placeholder="Enter keyword to Search..."
                             input-aria-labelledby="favoriteStateLabel"
                             input-aria-describedby="autocompleteDetailedDescription">
               <md-item-template>
                <md-button class="md-raised" ng-click="c.addtoReference(item,$event)" ng-if="c.ref_number.indexOf(item.number)  == -1" style="background-color: #C6375D;color: white;float:right;position:absolute;min-width: 50px;right: 10px;">Add</md-button>
                <md-button class="md-raised" ng-if="c.ref_number.indexOf(item.number)  > -1" ng-disabled="true" style="background-color:lightgray; float:right;position:absolute;min-width: 50px;right: 10px;">Added</md-button>
              	<div md-highlight-text="c.searchText" ng-click="c.addtoReference(item,$event)" md-highlight-flags="^i" style="margin: 0 -15px;padding: 0 15px;">{{item.display}}</div>
               </md-item-template>
              <md-not-found>
                No record matching "{{c.searchText}}" were found.
              </md-not-found>
            </md-autocomplete>
            <md-list>
              <md-subheader class="md-no-sticky" style="color:inherit;">Referenced
              </md-subheader>
              <div style="font-size: 14px;color: #717171;padding-left: 15px;padding-top: 5px;" ng-if="c.links.length == 0 && c.links.length == 0">No Linked Records</div>
              <md-list-item class="" ng-repeat="article in c.links">
                <div class="md-list-item-text">
                  <h5>
                    <a target="_blank" href="#" ng-click="c.openArticle(article);">
                      <i class="glyphicon glyphicon-file"></i> {{article.title}}
                    </a>
                  </h5>
                </div>
                <md-divider inset></md-divider>
                <md-icon class="md-secondary" ng-click="c.deleteLink(article)"  ng-style="{color: '#C6375D', 'font-size': '16px', height: '16px'}"><i class="fa fa-trash"></i></md-icon>
              </md-list-item>
            </md-list>
          </md-content>
        </div>
      </div>
    </div>
    <!-- comment section -->
    <div class="row row-space">
      <div class="col-md-9 feedback-block">
        <div class="comment-header">
          <h4>Comments</h4>
        </div>      
        <div class="comment-body">
          <div class="comment-submit">
            <h4>Add a comment</h4> 
            <div style="width:100%;"><textarea name="comment" rows="3" ng-model="c.comment" style="width:100%;border-color:#ddd;border-radius:5px;"></textarea></div>
            <div style="width:100%; margin-top: 5px; text-align:right;">
              <md-button class="md-raised" style="background-color: #C6375D;color: white;margin: 3px 0px 0px 10px;min-width: 50px;" ng-show="c.comment && c.comment != ''" ng-click="c.addComment()">Submit</md-button>
              <md-button ng-disabled="true" class="md-raised md-primary" style="margin: 3px 0px 0px 10px;min-width: 50px;"  ng-show="c.comment == undefined || c.comment == ''">Submit</md-button>
            </div> 
          </div>
          <div class="comment-label">
            <h4>Comments ({{comments.length}})</h4> 
          </div>
          <div class="comment-list">
            <div class="comment-row" ng-show = "comments.length == 0"> 
              <p class="break-word kb-comments-list ng-binding" style="white-space: pre-wrap">No comments.</p> 
            </div>
            <div class="comment-row" ng-repeat = "row in comments"> 
              <p style="font-weight: bold" class="author pad-right kb-comments-list ng-binding"> {{row.userName}} <span class="published pad-right"> - {{row.time}}</span> <a class="btn-link" ng-click="c.deleteComment(row.sys_id)" role="link" ng-show="c.isSu || row.userID == c.currentUserID">Delete</a></p> 
              <p class="break-word kb-comments-list ng-binding" style="white-space: pre-wrap">{{row.comment}}</p> 
             </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="deletionDiv" class="modal fade" data-keyborad="false" data-backdrop="static">
  <div class="modal-dialog modal-lg" style="width:20%;">
    <div class="modal-content" style="height:150px; overflow-y:auto; overflow-x: hidden;">
      <div class="col-md-12 message-box" align="center">
        Are you sure you want to delete this record?
      </div>
      <div class="col-md-12" align="center">
        <button class="btn btn-primary" style="margin-right: 20px;" ng-click="c.gotoDeletion();" data-dismiss="modal">Yes</button>
        <button class="btn btn-primary" ng-click="c.cancelDeletion();" data-dismiss="modal">No</button>
      </div>
    </div>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
